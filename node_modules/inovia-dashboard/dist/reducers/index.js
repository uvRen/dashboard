"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(exports,"__esModule",{value:!0});var _immutable=require("immutable"),_immutable2=_interopRequireDefault(_immutable),_uuid=require("uuid"),_uuid2=_interopRequireDefault(_uuid),_ACTION_TYPES=require("../actions/ACTION_TYPES"),_constants=require("../constants"),initialState=new _constants.DashboardRecord;exports["default"]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,e=arguments[1];switch(e.type){case _ACTION_TYPES.DASHBOARD_ACTIONS.REPLACE:var n=_immutable2["default"].List(e.dashboard.widgets?e.dashboard.widgets.map(function(t){return new _constants.WidgetRecord(t).set("groups",_immutable2["default"].Set(t.groups)).set("receivedSignals",t.receivedSignals||[])}):[]),u=e.dashboard.layout?new _constants.LayoutRecord({lg:_immutable2["default"].List(e.dashboard.layout.lg?e.dashboard.layout.lg.map(function(t){return new _constants.LayoutItemRecord(t)}):[]),md:_immutable2["default"].List(e.dashboard.layout.md?e.dashboard.layout.md.map(function(t){return new _constants.LayoutItemRecord(t)}):[]),sm:_immutable2["default"].List(e.dashboard.layout.sm?e.dashboard.layout.sm.map(function(t){return new _constants.LayoutItemRecord(t)}):[])}):new _constants.LayoutRecord;return new _constants.DashboardRecord(e.dashboard).set("widgets",n).set("layout",u);case _ACTION_TYPES.DASHBOARD_ACTIONS.TOGGLE_IS_PUBLIC:return t.set("isPublic",!t.isPublic);case _ACTION_TYPES.DASHBOARD_ACTIONS.OPEN:return t.set("id",e.identifier);case _ACTION_TYPES.DASHBOARD_ACTIONS.UPDATE_LAYOUT:var r=e.layout,s=r.lg?_immutable2["default"].List(r.lg.map(function(t){return new _constants.LayoutItemRecord(t)})):t.layout.lg,a=r.md?_immutable2["default"].List(r.md.map(function(t){return new _constants.LayoutItemRecord(t)})):t.layout.md,i=r.sm?_immutable2["default"].List(r.sm.map(function(t){return new _constants.LayoutItemRecord(t)})):t.layout.sm;return t.set("layout",new _constants.LayoutRecord({lg:s,md:a,sm:i}));case _ACTION_TYPES.DASHBOARD_ACTIONS.CLOSE:return initialState;case _ACTION_TYPES.DASHBOARD_ACTIONS.RESET_ALL_WIDGETS:return t.set("widgets",_immutable2["default"].List()).set("layout",new _constants.LayoutRecord);case _ACTION_TYPES.DASHBOARD_ACTIONS.UPDATE_WIDGET_SETTING:var o=e.sourceId,d=e.setting,c=t.widgets.findIndex(function(t){return t.id===o}),l=t.widgets.get(c),_=l.settings;return t.updateIn(["widgets",c],function(t){return t.set("settings",Object.assign({},_,d))});case _ACTION_TYPES.DASHBOARD_ACTIONS.SEND_SIGNAL_EXTERNAL:var m=e.signal,g=e.groups;return t.update("widgets",function(t){return t.map(function(t){return"ALL"===g||0===g.length&&0===t.groups.size||t.groups.intersect(g).size>0?t.update("receivedSignals",function(t){return t.filter(function(t){return"global"!==t.source}).concat([Object.assign(m,{source:"global"})])}):t})});case _ACTION_TYPES.DASHBOARD_ACTIONS.REMOVE_SIGNAL_BY_SOURCE:var f=e.sourceId;return t.update("widgets",function(t){return t.map(function(t){var e=t,n=e.receivedSignals,u=n.filter(function(t){return t.source!==f});return t.id===f&&(t=t.set("sentSignal",void 0)),u.length!==n.length?t.set("receivedSignals",u):t})});case _ACTION_TYPES.DASHBOARD_ACTIONS.SEND_SIGNAL:var A=e.sourceId,S=t.widgets.findIndex(function(t){return t.id===A}),I=t.widgets.get(S),T=Object.assign({},e.signal,{source:A});return t.update("widgets",function(t){return t.map(function(t){return t!==I&&(0===t.groups.size&&0===I.groups.size||t.groups.intersect(I.groups).size>0)?t.update("receivedSignals",function(t){return t.filter(function(t){return t.source!==A}).concat([T])}):t.set("sentSignal",e.signal)})});case _ACTION_TYPES.DASHBOARD_ACTIONS.ADD_WIDGET:var O=e.widgetType,y=e.settings,p=t.layout,D=_uuid2["default"].v4(),E=p.lg.push(new _constants.LayoutItemRecord({i:D,h:2,w:4,x:0,y:p.lg.reduce(function(t,e){return t+e.h},0)})),w=p.md.push(new _constants.LayoutItemRecord({i:D,h:2,w:4,x:0,y:p.md.reduce(function(t,e){return t+e.h},0)})),R=p.sm.push(new _constants.LayoutItemRecord({i:D,h:2,w:2,x:0,y:p.sm.reduce(function(t,e){return t+e.h},0)}));return t.set("layout",new _constants.LayoutRecord({lg:E,sm:R,md:w})).update("widgets",function(t){return t.push(new _constants.WidgetRecord({type:O,id:D,settings:y||{}}))});case _ACTION_TYPES.DASHBOARD_ACTIONS.CLONE_WIDGET:var L=e.index,N=t.widgets.get(L),b=_uuid2["default"].v4(),C=t.layout.lg.find(function(t){return t.i===N.id}),h=t.layout.md.find(function(t){return t.i===N.id}),v=t.layout.sm.find(function(t){return t.i===N.id}),P=N.set("id",b);return t.update("widgets",function(t){return t.push(P)}).updateIn(["layout","lg"],function(e){return e.push(C.set("i",b).set("y",t.layout.lg.reduce(function(t,e){return t+e.h},0)))}).updateIn(["layout","md"],function(e){return e.push(h.set("i",b).set("y",t.layout.md.reduce(function(t,e){return t+e.h},0)))}).updateIn(["layout","sm"],function(e){return e.push(v.set("i",b).set("y",t.layout.sm.reduce(function(t,e){return t+e.h},0)))});case _ACTION_TYPES.DASHBOARD_ACTIONS.DELETE_WIDGET:var Y=e.id;return t.update("widgets",function(t){return t.filter(function(t){return t.id!==Y})}).update("layout",function(t){var e=t.lg?t.lg.filter(function(t){return t.i!==Y}):Immutbale.List(),n=t.md?t.md.filter(function(t){return t.i!==Y}):Immutbale.List(),u=t.sm?t.sm.filter(function(t){return t.i!==Y}):Immutbale.List();return new _constants.LayoutRecord({lg:e,md:n,sm:u})});case _ACTION_TYPES.DASHBOARD_ACTIONS.REPLACE_WIDGET:var B=e.index,H=e.widget;return t.setIn(["widgets",B],new _constants.WidgetRecord(H));default:return t}};