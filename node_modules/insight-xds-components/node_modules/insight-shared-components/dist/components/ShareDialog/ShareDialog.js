"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function mapStoreToProps(e){return{shares:e.shares}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShareDialog=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactAddonsPureRenderMixin=require("react-addons-pure-render-mixin"),_reactAddonsPureRenderMixin2=_interopRequireDefault(_reactAddonsPureRenderMixin),_reactRedux=require("react-redux"),_reactIntl=require("react-intl"),_classnames=require("classnames"),_classnames2=_interopRequireDefault(_classnames),_Dialog=require("material-ui/Dialog"),_Dialog2=_interopRequireDefault(_Dialog),_FlatButton=require("material-ui/FlatButton"),_FlatButton2=_interopRequireDefault(_FlatButton),_SelectField=require("material-ui/SelectField"),_SelectField2=_interopRequireDefault(_SelectField),_AutoComplete=require("material-ui/AutoComplete"),_AutoComplete2=_interopRequireDefault(_AutoComplete),_TextField=require("material-ui/TextField"),_TextField2=_interopRequireDefault(_TextField),_MenuItem=require("material-ui/MenuItem"),_MenuItem2=_interopRequireDefault(_MenuItem),_Chip=require("material-ui/Chip"),_Chip2=_interopRequireDefault(_Chip),_public=require("material-ui/svg-icons/social/public"),_public2=_interopRequireDefault(_public),_modeEdit=require("material-ui/svg-icons/editor/mode-edit"),_modeEdit2=_interopRequireDefault(_modeEdit),_lock=require("material-ui/svg-icons/action/lock"),_lock2=_interopRequireDefault(_lock),_close=require("material-ui/svg-icons/navigation/close"),_close2=_interopRequireDefault(_close),_contentCopy=require("material-ui/svg-icons/content/content-copy"),_contentCopy2=_interopRequireDefault(_contentCopy),_check=require("material-ui/svg-icons/navigation/check"),_check2=_interopRequireDefault(_check),_sharesActions=require("../../actions/sharesActions"),shareActions=_interopRequireWildcard(_sharesActions),isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ShareDialog=exports.ShareDialog=function(e){function t(){var e;_classCallCheck(this,t);for(var r=arguments.length,a=Array(r),i=0;r>i;i++)a[i]=arguments[i];var n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a)));n.shouldComponentUpdate=_reactAddonsPureRenderMixin2["default"].shouldComponentUpdate.bind(n),n._setUserPermissions=n._setUserPermissions.bind(n),n._handleUserAdd=n._handleUserAdd.bind(n),n._handleUpdateInput=n._handleUpdateInput.bind(n),n._handleUserRemove=n._handleUserRemove.bind(n),n._highLightShareLink=n._highLightShareLink.bind(n),n._copyToClipBoard=n._copyToClipBoard.bind(n),n._renderCopyToClipboard=n._renderCopyToClipboard.bind(n),n._renderShareToUsers=n._renderShareToUsers.bind(n),n._renderSharedUsersList=n._renderSharedUsersList.bind(n),n._save=n._save.bind(n);var o=n.props.shares.find(function(e){return e.identifier===n.props.identifier}),s=o?o.toJS():{identifier:n.props.identifier,shareByLinkAccessType:"NONE",users:[]};return n.state={searchText:"",copiedToClipboard:!1,share:s,isNew:!!o},n}return _inherits(t,e),_createClass(t,[{key:"_setUserPermissions",value:function(e,t,r){var a=this.state.share;this.setState({share:Object.assign({},a,{shareByLinkAccessType:r})})}},{key:"_handleUpdateInput",value:function(e){this.setState({searchText:e})}},{key:"_handleUserAdd",value:function(e){this.setState({searchText:"",share:Object.assign({},share,{usersSharedWith:this.state.usersSharedWith.concat([e])})}),this.refs.searchUsersInput.focus()}},{key:"_save",value:function(){var e=this.props,t=e.dispatch,r=e.onClose,a=this.state,i=a.isNew,n=a.share,o=void 0;o=t(i?shareActions.add(n):shareActions.update(n)),o.then(function(){return r()})}},{key:"_handleUserRemove",value:function(e){this.setState({share:Object.assign({},share,{usersSharedWith:this.state.usersSharedWith.filter(function(t){return t!==e})})})}},{key:"_highLightShareLink",value:function(){this.refs.sharelink.input.setSelectionRange(0,this.refs.sharelink.input.value.length)}},{key:"_copyToClipBoard",value:function(){var e=this.refs.sharelink.input.value,t=document.createElement("textarea");t.style.position="fixed",t.style.top="0px",t.style.left="0",t.style.width="2em",t.style.height="2em",t.style.padding="0",t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy"),this.setState({copiedToClipboard:!0})}catch(r){this.setState({copiedToClipboard:!1})}document.body.removeChild(t)}},{key:"_renderCopyToClipboard",value:function(){var e=this.state.copiedToClipboard,t=this.props.intl;return e?_react2["default"].createElement(_FlatButton2["default"],{className:"share-dialog-copy-button",label:t.formatMessage({id:"copiedtoclipboard"}),labelposition:"before",icon:_react2["default"].createElement(_check2["default"],null),labelStyle:{textTransform:"capitalize"}}):_react2["default"].createElement(_FlatButton2["default"],{onTouchTap:this._copyToClipBoard,className:"share-dialog-copy-button",label:t.formatMessage({id:"copy"}),labelposition:"before",icon:_react2["default"].createElement(_contentCopy2["default"],null),labelStyle:{textTransform:"capitalize"}})}},{key:"_renderSharedUsersList",value:function(e){var t=this,r={marginRight:"4px"};return e.map(function(e,a){return _react2["default"].createElement(_Chip2["default"],{key:a,onRequestDelete:t._handleUserRemove.bind(null,e),style:r},e)})}},{key:"_renderShareToUsers",value:function(){var e=(this.props.intl,this.state);e.searchText,e.usersSharedWith,this.context.muiTheme;return null}},{key:"render",value:function(){var e=this.props.intl,t=this.state.share,r=[_react2["default"].createElement(_FlatButton2["default"],{key:0,label:e.formatMessage({id:"close"}),secondary:!0,onTouchTap:this.props.onClose}),_react2["default"].createElement(_FlatButton2["default"],{key:1,label:e.formatMessage({id:"submit"}),primary:!0,onTouchTap:this._save})];return _react2["default"].createElement(_Dialog2["default"],{className:"share-dialog-container",open:this.props.open,actions:r,modal:!1,onRequestClose:this.props.onClose},_react2["default"].createElement("h2",{className:"dialog-header"},e.formatMessage({id:"share.with.others.by.link"})),_react2["default"].createElement(_SelectField2["default"],{style:{width:"375px"},value:t.shareByLinkAccessType,onChange:this._setUserPermissions,floatingLabelText:e.formatMessage({id:"share.link.read.write.rights"})},_react2["default"].createElement(_MenuItem2["default"],{leftIcon:_react2["default"].createElement(_public2["default"],null),value:"READ",primaryText:e.formatMessage({id:"share.anyone.can.read"})}),_react2["default"].createElement(_MenuItem2["default"],{leftIcon:_react2["default"].createElement(_modeEdit2["default"],null),value:"WRITE",primaryText:e.formatMessage({id:"share.anyone.can.edit"})}),_react2["default"].createElement(_MenuItem2["default"],{leftIcon:_react2["default"].createElement(_lock2["default"],null),value:"NONE",primaryText:e.formatMessage({id:"share.make.private"})})),_react2["default"].createElement("br",null),_react2["default"].createElement(_TextField2["default"],{className:"share-dialog-link",style:{fontSize:"0.85em"},onTouchTap:this._highLightShareLink,disabled:!0,ref:"sharelink",id:"shareUrl",fullWidth:!0,value:window.location.href}),isSafari?"":this._renderCopyToClipboard())}}]),t}(_react2["default"].Component);ShareDialog.contextTypes={muiTheme:_react2["default"].PropTypes.object.isRequired},ShareDialog.propTypes={open:_react2["default"].PropTypes.bool.isRequired,onClose:_react2["default"].PropTypes.func.isRequired,identifier:_react2["default"].PropTypes.string.isRequired},exports["default"]=_reactRedux.connect(mapStoreToProps)(_reactIntl.injectIntl(ShareDialog));