"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_IconButton=require("material-ui/IconButton"),_IconButton2=_interopRequireDefault(_IconButton),_addCircleOutline=require("material-ui/svg-icons/content/add-circle-outline"),_addCircleOutline2=_interopRequireDefault(_addCircleOutline),_removeCircleOutline=require("material-ui/svg-icons/content/remove-circle-outline"),_removeCircleOutline2=_interopRequireDefault(_removeCircleOutline),_playlistAdd=require("material-ui/svg-icons/av/playlist-add"),_playlistAdd2=_interopRequireDefault(_playlistAdd),_insightSharedComponents=require("insight-shared-components"),_momentTimezone=require("moment-timezone"),_momentTimezone2=_interopRequireDefault(_momentTimezone),_Paper=require("material-ui/Paper"),_Paper2=_interopRequireDefault(_Paper),_colors=require("material-ui/styles/colors"),_XdsFilterExpression=require("./XdsFilterExpression"),_XdsFilterExpression2=_interopRequireDefault(_XdsFilterExpression),_constants=require("../../constants"),XdsFilterLogic=function(e){function t(){var e;_classCallCheck(this,t);for(var r=arguments.length,i=Array(r),s=0;r>s;s++)i[s]=arguments[s];var o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)));return o._addExpressionComponent=o._addExpressionComponent.bind(o),o._addLogicComponent=o._addLogicComponent.bind(o),o._removeMe=o._removeMe.bind(o),o._updateChildFilter=o._updateChildFilter.bind(o),o._removeChildFilter=o._removeChildFilter.bind(o),o._updateMe=o._updateMe.bind(o),o}return _inherits(t,e),_createClass(t,[{key:"_addLogicComponent",value:function(){var e={logic:"AND",filters:[]},t=void 0;if(this.props.filter.filters){var r=this.props.filter.filters.slice(0);r.push(e),t=Object.assign({},this.props.filter,{filters:r})}else{var i={logic:"AND",filters:[this.props.filter,e]};t=Object.assign({},i)}this.props.isRoot?this.props.updateChildFilter(t):this.props.updateChildFilter(this.props.index,t)}},{key:"_addExpressionComponent",value:function(){var e={field:void 0,operator:void 0,value:void 0},t=void 0;if(this.props.filter.filters){var r=this.props.filter.filters.slice(0);r.push(e),t=Object.assign({},this.props.filter,{filters:r})}else{var i={logic:"AND",filters:[this.props.filter,e]};t=Object.assign({},i)}this.props.isRoot?this.props.updateChildFilter(t):this.props.updateChildFilter(this.props.index,t)}},{key:"_removeChildFilter",value:function(e){var t={};if(this.props.filter.filters){var r=this.props.filter.filters.slice(0);r.splice(e,1),t=Object.assign({},this.props.filter,{filters:r})}this.props.isRoot?this.props.updateChildFilter(t):this.props.updateChildFilter(this.props.index,t)}},{key:"_removeMe",value:function(){this.props.removeChildFilter&&this.props.removeChildFilter(this.props.index)}},{key:"_updateChildFilter",value:function(e,t){var r=void 0;if(this.props.filter.filters){var i=this.props.filter.filters.slice(0);i[e]=t,r=Object.assign({},this.props.filter,{filters:i})}else r=Object.assign({},t);this.props.isRoot?this.props.updateChildFilter(r):this.props.updateChildFilter(this.props.index,r)}},{key:"_updateMe",value:function(e){var t=void 0;t=this.props.filter.hasOwnProperty("filters")?Object.assign({},this.props.filter,{logic:e}):{logic:e,filters:[this.props.filter]},this.props.isRoot?this.props.updateChildFilter(t):this.props.updateChildFilter(this.props.index,t)}},{key:"render",value:function(){var e=this,r=this.context.muiTheme,i=null;i=this.props.filter.hasOwnProperty("filters")?this.props.filter.filters.map(function(r,i){return r.hasOwnProperty("logic")?_react2["default"].createElement(t,{key:i,filter:r,mappings:e.props.mappings,index:i,removeChildFilter:e._removeChildFilter,updateChildFilter:e._updateChildFilter,timeZone:e.props.timeZone,operators:e.props.operators}):_react2["default"].createElement(_XdsFilterExpression2["default"],{key:i,filter:r,mappings:e.props.mappings,index:i,removeChildFilter:e._removeChildFilter,updateChildFilter:e._updateChildFilter,timeZone:e.props.timeZone,operators:e.props.operators})}):_react2["default"].createElement(_XdsFilterExpression2["default"],{key:0,filter:this.props.filter,mappings:this.props.mappings,index:0,removeChildFilter:this._removeChildFilter,updateChildFilter:this._updateChildFilter,timeZone:this.props.timeZone,operators:this.props.operators});var s=this.props.isRoot?null:_react2["default"].createElement(_IconButton2["default"],{className:"small-icon-btn flex-start",onTouchTap:this._removeMe},_react2["default"].createElement(_removeCircleOutline2["default"],null));return _react2["default"].createElement(_Paper2["default"],{className:"custom-filter-logic",rounded:!1,style:{marginTop:r.spacing.desktopGutterLess}},_react2["default"].createElement("div",{className:"custom-filter-header"},_react2["default"].createElement("div",{className:"logic-selector",style:{background:"AND"===this.props.filter.logic?_colors.blueGrey200:_colors.brown200}},_react2["default"].createElement(_insightSharedComponents.ValidatableDropDownList,{ref:"logicSelector",value:this.props.filter.logic,items:["AND","OR"],onChange:this._updateMe})),_react2["default"].createElement("div",{className:"logic-actions"},s,_react2["default"].createElement(_IconButton2["default"],{className:"small-icon-btn",onTouchTap:this._addExpressionComponent},_react2["default"].createElement(_addCircleOutline2["default"],null)),_react2["default"].createElement(_IconButton2["default"],{className:"small-icon-btn",onTouchTap:this._addLogicComponent},_react2["default"].createElement(_playlistAdd2["default"],null)))),_react2["default"].createElement("div",{style:{padding:r.spacing.desktopGutterLess}},i))}}]),t}(_react2["default"].Component);XdsFilterLogic.propTypes={filter:_react2["default"].PropTypes.object.isRequired,isRoot:_react2["default"].PropTypes.bool,mappings:_react2["default"].PropTypes.arrayOf(_react2["default"].PropTypes.shape({name:_react2["default"].PropTypes.string.isRequired,type:_react2["default"].PropTypes.string.isRequired})),index:_react2["default"].PropTypes.number,removeChildFilter:_react2["default"].PropTypes.func,updateChildFilter:_react2["default"].PropTypes.func.isRequired,timeZone:_react2["default"].PropTypes.string.isRequired,operators:_react2["default"].PropTypes.shape({string:_react2["default"].PropTypes.arrayOf(_react2["default"].PropTypes.shape({value:_react2["default"].PropTypes.string.isRequired,text:_react2["default"].PropTypes.string.isRequired})),number:_react2["default"].PropTypes.arrayOf(_react2["default"].PropTypes.shape({value:_react2["default"].PropTypes.string.isRequired,text:_react2["default"].PropTypes.string.isRequired})),date:_react2["default"].PropTypes.arrayOf(_react2["default"].PropTypes.shape({value:_react2["default"].PropTypes.string.isRequired,text:_react2["default"].PropTypes.string.isRequired})),bool:_react2["default"].PropTypes.arrayOf(_react2["default"].PropTypes.shape({value:_react2["default"].PropTypes.string.isRequired,text:_react2["default"].PropTypes.string.isRequired})),dynamicDate:_react2["default"].PropTypes.arrayOf(_react2["default"].PropTypes.shape({value:_react2["default"].PropTypes.string.isRequired,text:_react2["default"].PropTypes.string.isRequired}))}).isRequired},XdsFilterLogic.defaultProps={operators:{string:_constants.FILTER_DEFAULT_STRING_OPERATORS,number:_constants.FILTER_DEFAULT_NUMBER_OPERATORS,date:_constants.FILTER_DEFAULT_DATE_OPERATORS,bool:_constants.FILTER_DEFAULT_BOOLEAN_OPERATORS,dynamicDate:_constants.FILTER_DEFAULT_DYNAMIC_DATE_OPERATORS},timeZone:_momentTimezone2["default"].tz.guess()},XdsFilterLogic.contextTypes={muiTheme:_react2["default"].PropTypes.object.isRequired},exports["default"]=XdsFilterLogic;