"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactIntl=require("react-intl"),_ToolbarGroup=require("material-ui/Toolbar/ToolbarGroup"),_ToolbarGroup2=_interopRequireDefault(_ToolbarGroup),_ToolbarTitle=require("material-ui/Toolbar/ToolbarTitle"),_ToolbarTitle2=_interopRequireDefault(_ToolbarTitle),_IconButton=require("material-ui/IconButton"),_IconButton2=_interopRequireDefault(_IconButton),_Dialog=require("material-ui/Dialog"),_Dialog2=_interopRequireDefault(_Dialog),_AutoComplete=require("material-ui/AutoComplete"),_AutoComplete2=_interopRequireDefault(_AutoComplete),_FlatButton=require("material-ui/FlatButton"),_FlatButton2=_interopRequireDefault(_FlatButton),_add2=require("material-ui/svg-icons/content/add"),_add3=_interopRequireDefault(_add2),_delete2=require("material-ui/svg-icons/action/delete"),_delete3=_interopRequireDefault(_delete2),_close2=require("material-ui/svg-icons/navigation/close"),_close3=_interopRequireDefault(_close2),_SelectField=require("material-ui/SelectField"),_SelectField2=_interopRequireDefault(_SelectField),_MenuItem=require("material-ui/MenuItem"),_MenuItem2=_interopRequireDefault(_MenuItem),_Toggle=require("material-ui/Toggle"),_Toggle2=_interopRequireDefault(_Toggle),_security=require("../../actions/security"),_admin=require("inovia-api-client/insight/admin/admin"),XDSSecurityHeader=function(e){function t(){var e;_classCallCheck(this,t);for(var a=arguments.length,o=Array(a),i=0;a>i;i++)o[i]=arguments[i];var r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o)));return r._showAddDialog=r._showAddDialog.bind(r),r._showDeleteDialog=r._showDeleteDialog.bind(r),r._hideDeleteDialog=r._hideDeleteDialog.bind(r),r._delete=r._delete.bind(r),r._hideAddDialog=r._hideAddDialog.bind(r),r._onTypeChange=r._onTypeChange.bind(r),r._onChangeName=r._onChangeName.bind(r),r._onToggleRead=r._onToggleRead.bind(r),r._onToggleWrite=r._onToggleWrite.bind(r),r._onToggleAdmin=r._onToggleAdmin.bind(r),r._onUpdateName=r._onUpdateName.bind(r),r._add=r._add.bind(r),r._close=r._close.bind(r),r.state={name:"",type:"USER",read:!1,write:!1,admin:!1,dataSource:[]},r}return _inherits(t,e),_createClass(t,[{key:"_add",value:function(){var e=this.props,t=e.dispatch,a=e.storeName,o=this.state,i=o.name,r=o.type,l=o.read,n=o.write,u=o.admin;t(_security.addPermission(a,{name:i,type:r,read:l,write:n,admin:u}))}},{key:"_onToggleRead",value:function(){this.setState({read:!this.state.read})}},{key:"_showDeleteDialog",value:function(){var e=this.props.dispatch;e(_security.showDeleteDialog())}},{key:"_hideDeleteDialog",value:function(){var e=this.props.dispatch;e(_security.hideDeleteDialog())}},{key:"_delete",value:function(){var e=this.props,t=e.dispatch,a=e.security,o=a.selectedSecurityTokens,i=a.securityTokens,r=i.filter(function(e,t){return-1!==o.indexOf(t)});t(_security.deletePermission(r.toJS()))}},{key:"_onToggleWrite",value:function(){this.setState({write:!this.state.write})}},{key:"_onToggleAdmin",value:function(){this.setState({admin:!this.state.admin})}},{key:"_onTypeChange",value:function(e,t,a){this.setState({type:a,dataSource:[],name:""})}},{key:"_onUpdateName",value:function(e){var t=this,a=this.state.type;e.length>=3&&"GROUP"===a?_admin.listGroups(e).then(function(e){return t.setState({dataSource:e.groups})}):e.length>=4&&"USER"===a?_admin.listUsers(e).then(function(e){return t.setState({dataSource:e.users})}):e.length>=1&&"SCRIPT_KEY"===a?_admin.listScriptKeys(e).then(function(e){return t.setState({dataSource:e.map(function(e){return e.name+": "+e.description})})}):this.setState({dataSource:[]})}},{key:"_onChangeName",value:function(e){this.setState({name:e})}},{key:"_hideAddDialog",value:function(){var e=this.props.dispatch;e(_security.hideAddDialog())}},{key:"_showAddDialog",value:function(){var e=this.props.dispatch;e(_security.showAddDialog())}},{key:"_close",value:function(){this.props.dispatch(global.insight.navigateToParent())}},{key:"render",value:function(){var e=this.props,t=e.security,a=e.intl,o=this.context.muiTheme,i=this.state,r=i.name,l=i.type,n=i.read,u=i.write,s=i.admin,d=i.dataSource,c=t.selectedSecurityTokens;return _react2["default"].createElement("div",{className:"top-navigation-container"},_react2["default"].createElement(_ToolbarGroup2["default"],{className:"top-navigation-header"},_react2["default"].createElement(_ToolbarTitle2["default"],{text:a.formatMessage({id:"scriptKeys"}),style:{color:o.appBar.textColor}})),_react2["default"].createElement(_ToolbarGroup2["default"],{className:"top-navigation-action-buttons-container",lastChild:!0},_react2["default"].createElement(_FlatButton2["default"],{onTouchTap:this._showAddDialog,labelPosition:"before",label:a.formatMessage({id:"add"}),iconStyle:{color:o.appBar.textColor},icon:_react2["default"].createElement(_add3["default"],null)}),_react2["default"].createElement(_FlatButton2["default"],{style:0===c.size?{display:"hidden"}:{},onTouchTap:this._showDeleteDialog,labelPosition:"before",label:a.formatMessage({id:"delete"}),iconStyle:{color:o.appBar.textColor},icon:_react2["default"].createElement(_delete3["default"],null)}),_react2["default"].createElement(_IconButton2["default"],{title:a.formatMessage({id:"close"}),onTouchTap:this._close},_react2["default"].createElement(_close3["default"],null))),_react2["default"].createElement(_Dialog2["default"],{open:t.showAddDialog,actions:[_react2["default"].createElement(_FlatButton2["default"],{key:0,secondary:!0,label:a.formatMessage({id:"cancel"}),onTouchTap:this._hideAddDialog}),_react2["default"].createElement(_FlatButton2["default"],{key:1,primary:!0,disabled:!r,label:a.formatMessage({id:"confirm"}),onTouchTap:this._add})]},_react2["default"].createElement(_AutoComplete2["default"],{value:r,dataSource:d,onNewRequest:this._onChangeName,onUpdateInput:this._onUpdateName,openOnFocus:!0,onChange:this._onChangeName,fullWidth:!0,hintText:a.formatMessage({id:"name"})}),_react2["default"].createElement(_SelectField2["default"],{fullWidth:!0,value:l,onChange:this._onTypeChange},_react2["default"].createElement(_MenuItem2["default"],{value:"GROUP",primaryText:"GROUP"}),_react2["default"].createElement(_MenuItem2["default"],{value:"USER",primaryText:"USER"}),_react2["default"].createElement(_MenuItem2["default"],{value:"SCRIPT_KEY",primaryText:"SCRIPT_KEY"})),_react2["default"].createElement(_Toggle2["default"],{onToggle:this._onToggleRead,toggled:n,defaultToggled:n,label:a.formatMessage({id:"insight.xds.component.security.read"})}),_react2["default"].createElement(_Toggle2["default"],{onToggle:this._onToggleWrite,toggled:u,defaultToggled:u,label:a.formatMessage({id:"insight.xds.component.security.write"})}),_react2["default"].createElement(_Toggle2["default"],{onToggle:this._onToggleAdmin,toggled:s,defaultToggled:s,label:a.formatMessage({id:"insight.xds.component.security.admin"})})),_react2["default"].createElement(_Dialog2["default"],{open:t.showDeleteDialog,actions:[_react2["default"].createElement(_FlatButton2["default"],{key:0,secondary:!0,label:a.formatMessage({id:"cancel"}),onTouchTap:this._hideDeleteDialog}),_react2["default"].createElement(_FlatButton2["default"],{key:1,primary:!0,label:a.formatMessage({id:"confirm"}),onTouchTap:this._delete})]},_react2["default"].createElement(_reactIntl.FormattedMessage,{id:"insight.xds.component.security.deleteinfo"})))}}]),t}(_react2["default"].Component);XDSSecurityHeader.propTypes={security:_react2["default"].PropTypes.object.isRequired,dispatch:_react2["default"].PropTypes.func.isRequired,intl:_react2["default"].PropTypes.func.isRequired,storeName:_react2["default"].PropTypes.string.isRequired},XDSSecurityHeader.contextTypes={muiTheme:_react2["default"].PropTypes.object.isRequired},exports["default"]=_reactIntl.injectIntl(XDSSecurityHeader);