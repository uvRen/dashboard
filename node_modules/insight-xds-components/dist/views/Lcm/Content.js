"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_reactIntl=require("react-intl"),_reactAddonsPureRenderMixin=require("react-addons-pure-render-mixin"),_reactAddonsPureRenderMixin2=_interopRequireDefault(_reactAddonsPureRenderMixin),_lcm=require("../../actions/lcm"),lcmActions=_interopRequireWildcard(_lcm),_Card=require("material-ui/Card"),_DropDownMenu=require("material-ui/DropDownMenu"),_DropDownMenu2=_interopRequireDefault(_DropDownMenu),_MenuItem=require("material-ui/MenuItem"),_MenuItem2=_interopRequireDefault(_MenuItem),_Toggle=require("material-ui/Toggle"),_Toggle2=_interopRequireDefault(_Toggle),_Divider=require("material-ui/Divider"),_Divider2=_interopRequireDefault(_Divider),_infoOutline=require("material-ui/svg-icons/action/info-outline"),_infoOutline2=_interopRequireDefault(_infoOutline),LcmContent=function(e){function t(){var e;_classCallCheck(this,t);for(var a=arguments.length,r=Array(a),n=0;a>n;n++)r[n]=arguments[n];var i=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return i.shouldComponentUpdate=_reactAddonsPureRenderMixin2["default"].shouldComponentUpdate.bind(i),i._createTimeValues=i._createTimeValues.bind(i),i._readTimeValues=i._readTimeValues.bind(i),i._createOperation=i._createOperation.bind(i),i._createInterval=i._createInterval.bind(i),i._createTimeValues=i._createTimeValues.bind(i),i._createDisabledMessage=i._createDisabledMessage.bind(i),i._convertTimeValues=i._convertTimeValues.bind(i),i}return _inherits(t,e),_createClass(t,[{key:"_toggleExecute",value:function(e){this.props.dispatch(lcmActions.toggleExecute(e))}},{key:"_toggleInterval",value:function(e){e=-1>=e?36e5:-1,this.props.dispatch(lcmActions.changeInterval(e))}},{key:"_createTimeValues",value:function(e){var t=[];e&&t.push(_react2["default"].createElement(_MenuItem2["default"],{value:-1,key:0,primaryText:"Never"}));for(var a=1;30>=a;a++)t.push(_react2["default"].createElement(_MenuItem2["default"],{value:a,key:a,primaryText:a}));return t}},{key:"_readTimeValues",value:function(e){var t=[1,"hour(s)"],a=e;return a>=36e5&&(a/=36e5,a>720?(t[0]=a/720,t[1]="month(s)"):a>30?(t[0]=a/24,t[1]="day(s)"):t[0]=a),t}},{key:"_convertTimeValues",value:function(e,t,a){var r=e;return 36e5>r&&(r=36e5),"hour(s)"===t?"day(s)"===a?r=24*r:"month(s)"===a&&(r=720*r):"day(s)"===t?"hour(s)"===a?r/=24:"month(s)"===a&&(r=30*r):"month(s)"===t&&("hour(s)"===a?r/=720:"day(s)"===a&&(r/=30)),36e5>r&&(r=36e5),r}},{key:"_changeExecuteTimeUnit",value:function(e,t,a,r,n,i){var l=this._convertTimeValues(e,a,i);this.props.dispatch(lcmActions.changeTime(t,l))}},{key:"_changeIntervalTimeUnit",value:function(e,t,a,r,n,i){if(e>0){var l=this._convertTimeValues(e,a,i);this.props.dispatch(lcmActions.changeInterval(l))}}},{key:"_changeExecuteTimeValues",value:function(e,t,a,r,n){var i=36e5*n;"day(s)"===t?i=24*i:"month(s)"===t&&(i=720*i),this.props.dispatch(lcmActions.changeTime(e,i))}},{key:"_changeIntervalValues",value:function(e,t,a,r,n){if(-1===n)this.props.dispatch(lcmActions.changeInterval(-1));else{var i=36e5*n;"day(s)"===t?i=24*i:"month(s)"===t&&(i=720*i),this.props.dispatch(lcmActions.changeInterval(i))}}},{key:"_changeSchedule",value:function(e,t,a,r){this.props.dispatch(lcmActions.changeSchedule(e,r))}},{key:"_createDisabledMessage",value:function(e,t,a){return!e&&t?_react2["default"].createElement("p",{style:{color:"#666",margin:a.spacing.desktopGutterLess}},_react2["default"].createElement(_infoOutline2["default"],{style:{marginRight:a.spacing.desktopGutterMini,"float":"left"},color:"#666"}),"This action has been disabled by the server. It can be re-enabled by saving."):void 0}},{key:"_createOperation",value:function(e,t){var a=this.props.intl,r=this.context.muiTheme,n=this._readTimeValues(e.timeSinceLimit);return _react2["default"].createElement(_Card.Card,{style:{height:"100%"}},_react2["default"].createElement(_Card.CardText,null,_react2["default"].createElement("div",{className:"flex-container"},_react2["default"].createElement("div",{className:"flex-item",style:{flexGrow:10}},_react2["default"].createElement("h4",{style:{margin:0}},a.formatMessage({id:"insight.xds.component.lcm."+t}))),_react2["default"].createElement("div",{className:"flex-item"},_react2["default"].createElement(_Toggle2["default"],{label:e.execute?"On":"Off",labelPosition:"left",onToggle:this._toggleExecute.bind(this,t),toggled:e.execute}))),_react2["default"].createElement(_Divider2["default"],{style:{marginTop:r.spacing.desktopGutterLess,marginBottom:r.spacing.desktopGutterLess,color:r.palette.borderColor}}),_react2["default"].createElement("div",null,"Execute:"),_react2["default"].createElement("div",{className:"flex-container flex-form-row"},_react2["default"].createElement(_DropDownMenu2["default"],{className:"flex-item",value:n[0],disabled:!e.execute,onChange:this._changeExecuteTimeValues.bind(this,t,n[1]),underlineStyle:{visibility:"hidden"}},this._createTimeValues(!1)),_react2["default"].createElement(_DropDownMenu2["default"],{className:"flex-item",value:n[1],disabled:!e.execute,onChange:this._changeExecuteTimeUnit.bind(this,e.timeSinceLimit,t,n[1])},_react2["default"].createElement(_MenuItem2["default"],{value:"hour(s)",primaryText:a.formatMessage({id:"insight.xds.component.lcm.hours"})}),_react2["default"].createElement(_MenuItem2["default"],{value:"day(s)",primaryText:a.formatMessage({id:"insight.xds.component.lcm.days"})}),_react2["default"].createElement(_MenuItem2["default"],{value:"month(s)",primaryText:a.formatMessage({id:"insight.xds.component.lcm.months"})})),_react2["default"].createElement(_DropDownMenu2["default"],{className:"flex-item",value:e.schedule,disabled:!e.execute,onChange:this._changeSchedule.bind(this,t)},_react2["default"].createElement(_MenuItem2["default"],{value:"SINCE_LAST_DATA",primaryText:a.formatMessage({id:"insight.xds.component.lcm.after.last"})}),_react2["default"].createElement(_MenuItem2["default"],{value:"SINCE_STORE_CREATION",primaryText:a.formatMessage({id:"insight.xds.component.lcm.after.creation"})}),_react2["default"].createElement(_MenuItem2["default"],{value:"SINCE_STORE_STATE_CHANGE",primaryText:a.formatMessage({id:"insight.xds.component.lcm.since.change"})}))),this._createInterval(e,t,n),this._createDisabledMessage(e.enabled,e.execute,r)))}},{key:"_createInterval",value:function(e,t){if("FINALIZE"===t){var a=this._readTimeValues(e.interval),r=this.props.intl;return _react2["default"].createElement("div",null,_react2["default"].createElement("div",null,"Repeat in:"),_react2["default"].createElement("div",{className:"flex-container flex-form-row"},_react2["default"].createElement(_DropDownMenu2["default"],{className:"flex-item",disabled:!e.execute,value:-1===e.interval?e.interval:a[0],onChange:this._changeIntervalValues.bind(this,t,a[1])},this._createTimeValues(!0)),_react2["default"].createElement(_DropDownMenu2["default"],{className:"flex-item",disabled:!e.execute||-1===e.interval,value:a[1],onChange:this._changeIntervalTimeUnit.bind(this,e.interval,t,a[1])},_react2["default"].createElement(_MenuItem2["default"],{value:"hour(s)",primaryText:r.formatMessage({id:"insight.xds.component.lcm.hours"})}),_react2["default"].createElement(_MenuItem2["default"],{value:"day(s)",primaryText:r.formatMessage({id:"insight.xds.component.lcm.days"})}),_react2["default"].createElement(_MenuItem2["default"],{value:"month(s)",primaryText:r.formatMessage({id:"insight.xds.component.lcm.months"})}))))}}},{key:"render",value:function(){var e=this.props.lcm,t=(this.context.muiTheme,e.model.operationSchedules);return _react2["default"].createElement("div",{className:"lcm-main-view"},_react2["default"].createElement("div",{className:"lcm-operations flex-container flex-gutters-less"},_react2["default"].createElement("div",{className:"flex-item"},this._createOperation(t.FINALIZE,"FINALIZE")),_react2["default"].createElement("div",{className:"flex-item"},this._createOperation(t.DELETE,"DELETE")),_react2["default"].createElement("div",{className:"flex-item"},this._createOperation(t.CLOSE,"CLOSE"))))}}]),t}(_react2["default"].Component);exports["default"]=_reactIntl.injectIntl(LcmContent),LcmContent.contextTypes={muiTheme:_react2["default"].PropTypes.object};